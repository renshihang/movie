{"ast":null,"code":"import _initializerDefineProperty from \"@babel/runtime/helpers/initializerDefineProperty\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _applyDecoratedDescriptor from \"@babel/runtime/helpers/applyDecoratedDescriptor\";\nimport _initializerWarningHelper from \"@babel/runtime/helpers/initializerWarningHelper\";\n\nvar _dec, _dec2, _class, _class2, _descriptor, _temp;\n\nimport { AttributeType, gl, TYPES } from '@antv/l7-core';\nimport { inject, injectable } from 'inversify';\nvar RegisterStyleAttributePlugin = (_dec = injectable(), _dec2 = inject(TYPES.ILogService), _dec(_class = (_class2 = (_temp = function () {\n  function RegisterStyleAttributePlugin() {\n    _classCallCheck(this, RegisterStyleAttributePlugin);\n\n    _initializerDefineProperty(this, \"logger\", _descriptor, this);\n  }\n\n  _createClass(RegisterStyleAttributePlugin, [{\n    key: \"apply\",\n    value: function apply(layer, _ref) {\n      var _this = this;\n\n      var styleAttributeService = _ref.styleAttributeService;\n      layer.hooks.init.tap('RegisterStyleAttributePlugin', function () {\n        _this.registerBuiltinAttributes(styleAttributeService);\n      });\n    }\n  }, {\n    key: \"registerBuiltinAttributes\",\n    value: function registerBuiltinAttributes(styleAttributeService) {\n      styleAttributeService.registerStyleAttribute({\n        name: 'position',\n        type: AttributeType.Attribute,\n        descriptor: {\n          name: 'a_Position',\n          buffer: {\n            data: [],\n            type: gl.FLOAT\n          },\n          size: 3,\n          update: function update(feature, featureIdx, vertex) {\n            return vertex.length === 2 ? [vertex[0], vertex[1], 0] : [vertex[0], vertex[1], vertex[2]];\n          }\n        }\n      });\n      styleAttributeService.registerStyleAttribute({\n        name: 'filter',\n        type: AttributeType.Attribute,\n        descriptor: {\n          name: 'filter',\n          buffer: {\n            usage: gl.DYNAMIC_DRAW,\n            data: [],\n            type: gl.FLOAT\n          },\n          size: 1,\n          update: function update(feature, featureIdx) {\n            var filter = feature.filter;\n            return filter ? [1] : [0];\n          }\n        }\n      });\n      styleAttributeService.registerStyleAttribute({\n        name: 'color',\n        type: AttributeType.Attribute,\n        descriptor: {\n          name: 'a_Color',\n          buffer: {\n            usage: gl.DYNAMIC_DRAW,\n            data: [],\n            type: gl.FLOAT\n          },\n          size: 4,\n          update: function update(feature, featureIdx) {\n            var color = feature.color;\n            return !color || !color.length ? [0, 0, 0, 0] : color;\n          }\n        }\n      });\n    }\n  }]);\n\n  return RegisterStyleAttributePlugin;\n}(), _temp), _descriptor = _applyDecoratedDescriptor(_class2.prototype, \"logger\", [_dec2], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _class2)) || _class);\nexport { RegisterStyleAttributePlugin as default };","map":{"version":3,"sources":["../../src/plugins/RegisterStyleAttributePlugin.ts"],"names":["injectable","RegisterStyleAttributePlugin","inject","TYPES","layer","styleAttributeService","name","type","AttributeType","descriptor","buffer","data","gl","FLOAT","size","update","vertex","usage","filter","feature","color"],"mappings":"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","sourcesContent":["import {\n  AttributeType,\n  gl,\n  IEncodeFeature,\n  ILayer,\n  ILayerPlugin,\n  ILogService,\n  IStyleAttributeService,\n  TYPES,\n} from '@antv/l7-core';\nimport { inject, injectable } from 'inversify';\n\n/**\n * 在初始化阶段完成属性的注册，以及首次根据 Layer 指定的三角化方法完成 indices 和 attribute 的创建\n */\n@injectable()\nexport default class RegisterStyleAttributePlugin implements ILayerPlugin {\n  @inject(TYPES.ILogService)\n  private readonly logger: ILogService;\n\n  public apply(\n    layer: ILayer,\n    {\n      styleAttributeService,\n    }: { styleAttributeService: IStyleAttributeService },\n  ) {\n    layer.hooks.init.tap('RegisterStyleAttributePlugin', () => {\n      this.registerBuiltinAttributes(styleAttributeService);\n    });\n  }\n\n  private registerBuiltinAttributes(\n    styleAttributeService: IStyleAttributeService,\n  ) {\n    styleAttributeService.registerStyleAttribute({\n      name: 'position',\n      type: AttributeType.Attribute,\n      descriptor: {\n        name: 'a_Position',\n        buffer: {\n          data: [],\n          type: gl.FLOAT,\n        },\n        size: 3,\n        update: (\n          feature: IEncodeFeature,\n          featureIdx: number,\n          vertex: number[],\n        ) => {\n          return vertex.length === 2\n            ? [vertex[0], vertex[1], 0]\n            : [vertex[0], vertex[1], vertex[2]];\n        },\n      },\n    });\n\n    styleAttributeService.registerStyleAttribute({\n      name: 'filter',\n      type: AttributeType.Attribute,\n      descriptor: {\n        name: 'filter',\n        buffer: {\n          // give the WebGL driver a hint that this buffer may change\n          usage: gl.DYNAMIC_DRAW,\n          data: [],\n          type: gl.FLOAT,\n        },\n        size: 1,\n        update: (feature: IEncodeFeature, featureIdx: number) => {\n          const { filter } = feature;\n          return filter ? [1] : [0];\n        },\n      },\n    });\n    styleAttributeService.registerStyleAttribute({\n      name: 'color',\n      type: AttributeType.Attribute,\n      descriptor: {\n        name: 'a_Color',\n        buffer: {\n          // give the WebGL driver a hint that this buffer may change\n          usage: gl.DYNAMIC_DRAW,\n          data: [],\n          type: gl.FLOAT,\n        },\n        size: 4,\n        update: (feature: IEncodeFeature, featureIdx: number) => {\n          const { color } = feature;\n          return !color || !color.length ? [0, 0, 0, 0] : color;\n        },\n      },\n    });\n  }\n}\n"]},"metadata":{},"sourceType":"module"}