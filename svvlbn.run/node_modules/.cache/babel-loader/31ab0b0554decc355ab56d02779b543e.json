{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar inject_1 = require(\"../annotation/inject\");\n\nvar ERROR_MSGS = require(\"../constants/error_msgs\");\n\nvar literal_types_1 = require(\"../constants/literal_types\");\n\nvar METADATA_KEY = require(\"../constants/metadata_keys\");\n\nvar serialization_1 = require(\"../utils/serialization\");\n\nexports.getFunctionName = serialization_1.getFunctionName;\n\nvar target_1 = require(\"./target\");\n\nfunction getDependencies(metadataReader, func) {\n  var constructorName = serialization_1.getFunctionName(func);\n  var targets = getTargets(metadataReader, constructorName, func, false);\n  return targets;\n}\n\nexports.getDependencies = getDependencies;\n\nfunction getTargets(metadataReader, constructorName, func, isBaseClass) {\n  var metadata = metadataReader.getConstructorMetadata(func);\n  var serviceIdentifiers = metadata.compilerGeneratedMetadata;\n\n  if (serviceIdentifiers === undefined) {\n    var msg = ERROR_MSGS.MISSING_INJECTABLE_ANNOTATION + \" \" + constructorName + \".\";\n    throw new Error(msg);\n  }\n\n  var constructorArgsMetadata = metadata.userGeneratedMetadata;\n  var keys = Object.keys(constructorArgsMetadata);\n  var hasUserDeclaredUnknownInjections = func.length === 0 && keys.length > 0;\n  var iterations = hasUserDeclaredUnknownInjections ? keys.length : func.length;\n  var constructorTargets = getConstructorArgsAsTargets(isBaseClass, constructorName, serviceIdentifiers, constructorArgsMetadata, iterations);\n  var propertyTargets = getClassPropsAsTargets(metadataReader, func);\n  var targets = constructorTargets.concat(propertyTargets);\n  return targets;\n}\n\nfunction getConstructorArgsAsTarget(index, isBaseClass, constructorName, serviceIdentifiers, constructorArgsMetadata) {\n  var targetMetadata = constructorArgsMetadata[index.toString()] || [];\n  var metadata = formatTargetMetadata(targetMetadata);\n  var isManaged = metadata.unmanaged !== true;\n  var serviceIdentifier = serviceIdentifiers[index];\n  var injectIdentifier = metadata.inject || metadata.multiInject;\n  serviceIdentifier = injectIdentifier ? injectIdentifier : serviceIdentifier;\n\n  if (serviceIdentifier instanceof inject_1.LazyServiceIdentifer) {\n    serviceIdentifier = serviceIdentifier.unwrap();\n  }\n\n  if (isManaged) {\n    var isObject = serviceIdentifier === Object;\n    var isFunction = serviceIdentifier === Function;\n    var isUndefined = serviceIdentifier === undefined;\n    var isUnknownType = isObject || isFunction || isUndefined;\n\n    if (!isBaseClass && isUnknownType) {\n      var msg = ERROR_MSGS.MISSING_INJECT_ANNOTATION + \" argument \" + index + \" in class \" + constructorName + \".\";\n      throw new Error(msg);\n    }\n\n    var target = new target_1.Target(literal_types_1.TargetTypeEnum.ConstructorArgument, metadata.targetName, serviceIdentifier);\n    target.metadata = targetMetadata;\n    return target;\n  }\n\n  return null;\n}\n\nfunction getConstructorArgsAsTargets(isBaseClass, constructorName, serviceIdentifiers, constructorArgsMetadata, iterations) {\n  var targets = [];\n\n  for (var i = 0; i < iterations; i++) {\n    var index = i;\n    var target = getConstructorArgsAsTarget(index, isBaseClass, constructorName, serviceIdentifiers, constructorArgsMetadata);\n\n    if (target !== null) {\n      targets.push(target);\n    }\n  }\n\n  return targets;\n}\n\nfunction getClassPropsAsTargets(metadataReader, constructorFunc) {\n  var classPropsMetadata = metadataReader.getPropertiesMetadata(constructorFunc);\n  var targets = [];\n  var keys = Object.keys(classPropsMetadata);\n\n  for (var _i = 0, keys_1 = keys; _i < keys_1.length; _i++) {\n    var key = keys_1[_i];\n    var targetMetadata = classPropsMetadata[key];\n    var metadata = formatTargetMetadata(classPropsMetadata[key]);\n    var targetName = metadata.targetName || key;\n    var serviceIdentifier = metadata.inject || metadata.multiInject;\n    var target = new target_1.Target(literal_types_1.TargetTypeEnum.ClassProperty, targetName, serviceIdentifier);\n    target.metadata = targetMetadata;\n    targets.push(target);\n  }\n\n  var baseConstructor = Object.getPrototypeOf(constructorFunc.prototype).constructor;\n\n  if (baseConstructor !== Object) {\n    var baseTargets = getClassPropsAsTargets(metadataReader, baseConstructor);\n    targets = targets.concat(baseTargets);\n  }\n\n  return targets;\n}\n\nfunction getBaseClassDependencyCount(metadataReader, func) {\n  var baseConstructor = Object.getPrototypeOf(func.prototype).constructor;\n\n  if (baseConstructor !== Object) {\n    var baseConstructorName = serialization_1.getFunctionName(baseConstructor);\n    var targets = getTargets(metadataReader, baseConstructorName, baseConstructor, true);\n    var metadata = targets.map(function (t) {\n      return t.metadata.filter(function (m) {\n        return m.key === METADATA_KEY.UNMANAGED_TAG;\n      });\n    });\n    var unmanagedCount = [].concat.apply([], metadata).length;\n    var dependencyCount = targets.length - unmanagedCount;\n\n    if (dependencyCount > 0) {\n      return dependencyCount;\n    } else {\n      return getBaseClassDependencyCount(metadataReader, baseConstructor);\n    }\n  } else {\n    return 0;\n  }\n}\n\nexports.getBaseClassDependencyCount = getBaseClassDependencyCount;\n\nfunction formatTargetMetadata(targetMetadata) {\n  var targetMetadataMap = {};\n  targetMetadata.forEach(function (m) {\n    targetMetadataMap[m.key.toString()] = m.value;\n  });\n  return {\n    inject: targetMetadataMap[METADATA_KEY.INJECT_TAG],\n    multiInject: targetMetadataMap[METADATA_KEY.MULTI_INJECT_TAG],\n    targetName: targetMetadataMap[METADATA_KEY.NAME_TAG],\n    unmanaged: targetMetadataMap[METADATA_KEY.UNMANAGED_TAG]\n  };\n}","map":{"version":3,"sources":["/Users/renshihang/Desktop/svvlbn.run/node_modules/inversify/lib/planning/reflection_utils.js"],"names":["Object","defineProperty","exports","value","inject_1","require","ERROR_MSGS","literal_types_1","METADATA_KEY","serialization_1","getFunctionName","target_1","getDependencies","metadataReader","func","constructorName","targets","getTargets","isBaseClass","metadata","getConstructorMetadata","serviceIdentifiers","compilerGeneratedMetadata","undefined","msg","MISSING_INJECTABLE_ANNOTATION","Error","constructorArgsMetadata","userGeneratedMetadata","keys","hasUserDeclaredUnknownInjections","length","iterations","constructorTargets","getConstructorArgsAsTargets","propertyTargets","getClassPropsAsTargets","concat","getConstructorArgsAsTarget","index","targetMetadata","toString","formatTargetMetadata","isManaged","unmanaged","serviceIdentifier","injectIdentifier","inject","multiInject","LazyServiceIdentifer","unwrap","isObject","isFunction","Function","isUndefined","isUnknownType","MISSING_INJECT_ANNOTATION","target","Target","TargetTypeEnum","ConstructorArgument","targetName","i","push","constructorFunc","classPropsMetadata","getPropertiesMetadata","_i","keys_1","key","ClassProperty","baseConstructor","getPrototypeOf","prototype","constructor","baseTargets","getBaseClassDependencyCount","baseConstructorName","map","t","filter","m","UNMANAGED_TAG","unmanagedCount","apply","dependencyCount","targetMetadataMap","forEach","INJECT_TAG","MULTI_INJECT_TAG","NAME_TAG"],"mappings":"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","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar inject_1 = require(\"../annotation/inject\");\nvar ERROR_MSGS = require(\"../constants/error_msgs\");\nvar literal_types_1 = require(\"../constants/literal_types\");\nvar METADATA_KEY = require(\"../constants/metadata_keys\");\nvar serialization_1 = require(\"../utils/serialization\");\nexports.getFunctionName = serialization_1.getFunctionName;\nvar target_1 = require(\"./target\");\nfunction getDependencies(metadataReader, func) {\n    var constructorName = serialization_1.getFunctionName(func);\n    var targets = getTargets(metadataReader, constructorName, func, false);\n    return targets;\n}\nexports.getDependencies = getDependencies;\nfunction getTargets(metadataReader, constructorName, func, isBaseClass) {\n    var metadata = metadataReader.getConstructorMetadata(func);\n    var serviceIdentifiers = metadata.compilerGeneratedMetadata;\n    if (serviceIdentifiers === undefined) {\n        var msg = ERROR_MSGS.MISSING_INJECTABLE_ANNOTATION + \" \" + constructorName + \".\";\n        throw new Error(msg);\n    }\n    var constructorArgsMetadata = metadata.userGeneratedMetadata;\n    var keys = Object.keys(constructorArgsMetadata);\n    var hasUserDeclaredUnknownInjections = (func.length === 0 && keys.length > 0);\n    var iterations = (hasUserDeclaredUnknownInjections) ? keys.length : func.length;\n    var constructorTargets = getConstructorArgsAsTargets(isBaseClass, constructorName, serviceIdentifiers, constructorArgsMetadata, iterations);\n    var propertyTargets = getClassPropsAsTargets(metadataReader, func);\n    var targets = constructorTargets.concat(propertyTargets);\n    return targets;\n}\nfunction getConstructorArgsAsTarget(index, isBaseClass, constructorName, serviceIdentifiers, constructorArgsMetadata) {\n    var targetMetadata = constructorArgsMetadata[index.toString()] || [];\n    var metadata = formatTargetMetadata(targetMetadata);\n    var isManaged = metadata.unmanaged !== true;\n    var serviceIdentifier = serviceIdentifiers[index];\n    var injectIdentifier = (metadata.inject || metadata.multiInject);\n    serviceIdentifier = (injectIdentifier) ? (injectIdentifier) : serviceIdentifier;\n    if (serviceIdentifier instanceof inject_1.LazyServiceIdentifer) {\n        serviceIdentifier = serviceIdentifier.unwrap();\n    }\n    if (isManaged) {\n        var isObject = serviceIdentifier === Object;\n        var isFunction = serviceIdentifier === Function;\n        var isUndefined = serviceIdentifier === undefined;\n        var isUnknownType = (isObject || isFunction || isUndefined);\n        if (!isBaseClass && isUnknownType) {\n            var msg = ERROR_MSGS.MISSING_INJECT_ANNOTATION + \" argument \" + index + \" in class \" + constructorName + \".\";\n            throw new Error(msg);\n        }\n        var target = new target_1.Target(literal_types_1.TargetTypeEnum.ConstructorArgument, metadata.targetName, serviceIdentifier);\n        target.metadata = targetMetadata;\n        return target;\n    }\n    return null;\n}\nfunction getConstructorArgsAsTargets(isBaseClass, constructorName, serviceIdentifiers, constructorArgsMetadata, iterations) {\n    var targets = [];\n    for (var i = 0; i < iterations; i++) {\n        var index = i;\n        var target = getConstructorArgsAsTarget(index, isBaseClass, constructorName, serviceIdentifiers, constructorArgsMetadata);\n        if (target !== null) {\n            targets.push(target);\n        }\n    }\n    return targets;\n}\nfunction getClassPropsAsTargets(metadataReader, constructorFunc) {\n    var classPropsMetadata = metadataReader.getPropertiesMetadata(constructorFunc);\n    var targets = [];\n    var keys = Object.keys(classPropsMetadata);\n    for (var _i = 0, keys_1 = keys; _i < keys_1.length; _i++) {\n        var key = keys_1[_i];\n        var targetMetadata = classPropsMetadata[key];\n        var metadata = formatTargetMetadata(classPropsMetadata[key]);\n        var targetName = metadata.targetName || key;\n        var serviceIdentifier = (metadata.inject || metadata.multiInject);\n        var target = new target_1.Target(literal_types_1.TargetTypeEnum.ClassProperty, targetName, serviceIdentifier);\n        target.metadata = targetMetadata;\n        targets.push(target);\n    }\n    var baseConstructor = Object.getPrototypeOf(constructorFunc.prototype).constructor;\n    if (baseConstructor !== Object) {\n        var baseTargets = getClassPropsAsTargets(metadataReader, baseConstructor);\n        targets = targets.concat(baseTargets);\n    }\n    return targets;\n}\nfunction getBaseClassDependencyCount(metadataReader, func) {\n    var baseConstructor = Object.getPrototypeOf(func.prototype).constructor;\n    if (baseConstructor !== Object) {\n        var baseConstructorName = serialization_1.getFunctionName(baseConstructor);\n        var targets = getTargets(metadataReader, baseConstructorName, baseConstructor, true);\n        var metadata = targets.map(function (t) {\n            return t.metadata.filter(function (m) {\n                return m.key === METADATA_KEY.UNMANAGED_TAG;\n            });\n        });\n        var unmanagedCount = [].concat.apply([], metadata).length;\n        var dependencyCount = targets.length - unmanagedCount;\n        if (dependencyCount > 0) {\n            return dependencyCount;\n        }\n        else {\n            return getBaseClassDependencyCount(metadataReader, baseConstructor);\n        }\n    }\n    else {\n        return 0;\n    }\n}\nexports.getBaseClassDependencyCount = getBaseClassDependencyCount;\nfunction formatTargetMetadata(targetMetadata) {\n    var targetMetadataMap = {};\n    targetMetadata.forEach(function (m) {\n        targetMetadataMap[m.key.toString()] = m.value;\n    });\n    return {\n        inject: targetMetadataMap[METADATA_KEY.INJECT_TAG],\n        multiInject: targetMetadataMap[METADATA_KEY.MULTI_INJECT_TAG],\n        targetName: targetMetadataMap[METADATA_KEY.NAME_TAG],\n        unmanaged: targetMetadataMap[METADATA_KEY.UNMANAGED_TAG]\n    };\n}\n"]},"metadata":{},"sourceType":"script"}