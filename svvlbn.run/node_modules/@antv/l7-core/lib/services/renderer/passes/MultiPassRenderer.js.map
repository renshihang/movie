{"version":3,"sources":["../../../../src/services/renderer/passes/MultiPassRenderer.ts"],"names":["MultiPassRenderer","TYPES","IPostProcessor","passes","layer","renderFlag","postProcessor","pass","render","width","height","resize","config","getType","PassType","PostProcessing","add","init","push","index","splice"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAAA;;AACA;;AAEA;;;;IA4BqBA,iB,WADpB,4B,UAIE,uBAAOC,aAAMC,cAAb,C;;;SAFOC,M,GAAgC,E;;SAKhCC,K;SACAC,U;;;;;6BAEQD,K,EAAe;AAC7B,WAAKA,KAAL,GAAaA,KAAb;AACD;;;kCAEoBC,U,EAAqB;AACxC,WAAKA,UAAL,GAAkBA,UAAlB;AACD;;;oCAEsB;AACrB,aAAO,KAAKA,UAAZ;AACD;;;uCAEyB;AACxB,aAAO,KAAKC,aAAZ;AACD;;;;;;;;;;;;;;;4BAGoB,KAAKH,M;;;;;;;;AAAbI,gBAAAA,I;;uBACHA,IAAI,CAACC,MAAL,CAAY,KAAKJ,KAAjB,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;uBAEF,KAAKE,aAAL,CAAmBE,MAAnB,CAA0B,KAAKJ,KAA/B,C;;;;;;;;;;;;;;;;;;2BAGMK,K,EAAeC,M,EAAgB;AAC3C,WAAKJ,aAAL,CAAmBK,MAAnB,CAA0BF,KAA1B,EAAiCC,MAAjC;AACD;;;wBAEaH,I,EAAgBK,M,EAAqB;AACjD,UAAIL,IAAI,CAACM,OAAL,OAAmBC,6BAASC,cAAhC,EAAgD;AAC9C,aAAKT,aAAL,CAAmBU,GAAnB,CACET,IADF,EAEE,KAAKH,KAFP,EAGEQ,MAHF;AAKD,OAND,MAMO;AACLL,QAAAA,IAAI,CAACU,IAAL,CAAU,KAAKb,KAAf,EAAsBQ,MAAtB;AACA,aAAKT,MAAL,CAAYe,IAAZ,CAAiBX,IAAjB;AACD;AACF;;;2BAEgBA,I,EAAgBK,M,EAAoBO,K,EAAe;AAClEZ,MAAAA,IAAI,CAACU,IAAL,CAAU,KAAKb,KAAf,EAAsBQ,MAAtB;AACA,WAAKT,MAAL,CAAYiB,MAAZ,CAAmBD,KAAnB,EAA0B,CAA1B,EAA6BZ,IAA7B;AACD","sourcesContent":["import { inject, injectable } from 'inversify';\nimport { TYPES } from '../../../types';\nimport { ILayer } from '../../layer/ILayerService';\nimport {\n  IMultiPassRenderer,\n  IPass,\n  IPostProcessingPass,\n  IPostProcessor,\n  PassType,\n} from '../IMultiPassRenderer';\n\n/**\n * ported from Three.js EffectComposer\n * @example\n * const renderer = new MultiPassRenderer([\n *   new ClearPass(),\n *   new RenderPass({\n *     models: [\n *       new Model(),\n *       new Model(),\n *     ],\n *   }),\n *   new CopyPass({\n *     renderToScreen: true,\n *   }),\n *   new TAAPass(),\n * ]);\n * renderer.render();\n * @see https://yuque.antfin-inc.com/yuqi.pyq/fgetpa/apuvbf#dRM8W\n */\n@injectable()\nexport default class MultiPassRenderer implements IMultiPassRenderer {\n  private passes: Array<IPass<unknown>> = [];\n\n  @inject(TYPES.IPostProcessor)\n  private postProcessor: IPostProcessor;\n\n  private layer: ILayer;\n  private renderFlag: boolean;\n\n  public setLayer(layer: ILayer) {\n    this.layer = layer;\n  }\n\n  public setRenderFlag(renderFlag: boolean) {\n    this.renderFlag = renderFlag;\n  }\n\n  public getRenderFlag() {\n    return this.renderFlag;\n  }\n\n  public getPostProcessor() {\n    return this.postProcessor;\n  }\n\n  public async render() {\n    for (const pass of this.passes) {\n      await pass.render(this.layer);\n    }\n    await this.postProcessor.render(this.layer);\n  }\n\n  public resize(width: number, height: number) {\n    this.postProcessor.resize(width, height);\n  }\n\n  public add<T>(pass: IPass<T>, config?: Partial<T>) {\n    if (pass.getType() === PassType.PostProcessing) {\n      this.postProcessor.add<T>(\n        pass as IPostProcessingPass<T>,\n        this.layer,\n        config,\n      );\n    } else {\n      pass.init(this.layer, config);\n      this.passes.push(pass);\n    }\n  }\n\n  public insert<T>(pass: IPass<T>, config: Partial<T>, index: number) {\n    pass.init(this.layer, config);\n    this.passes.splice(index, 0, pass);\n  }\n}\n"],"file":"MultiPassRenderer.js"}