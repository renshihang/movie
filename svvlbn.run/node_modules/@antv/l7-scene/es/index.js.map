{"version":3,"sources":["../src/index.ts"],"names":["Logo","createLayerContainer","createSceneContainer","SceneEventList","TYPES","ReglRendererService","DOM","Scene","config","sceneService","mapService","controlService","layerService","iconService","markerService","popupService","container","id","map","sceneContainer","setContainer","bind","IRendererService","to","inSingletonScope","get","ISceneService","IMapService","IIconService","IControlService","ILayerService","IMarkerService","IPopupService","initComponent","init","addControl","ExportMap2Png","layer","layerContainer","addLayer","getLayers","getLayer","remove","removeAllLayers","render","img","addImage","hasImage","removeImage","ctr","removeControl","marker","addMarker","addMarkerLayer","removeMarkerLayer","removeAllMarkers","popup","addPopup","type","handle","indexOf","on","off","getZoom","getCenter","getPitch","getRotation","getBounds","rotation","setRotation","zoomIn","zoomOut","p","panTo","pixel","zoom","setZoom","bound","fitBounds","center","setZoomAndCenter","style","setMapStyle","pixelToLngLat","lnglat","lngLatToPixel","containerToLngLat","lngLatToContainer","destroy","constructor","name","IPostProcessingPass","whenTargetNamed","getContainer"],"mappings":"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","sourcesContent":["import { Logo } from '@antv/l7-component';\nimport {\n  Bounds,\n  createLayerContainer,\n  createSceneContainer,\n  IControl,\n  IControlService,\n  IIconService,\n  IImage,\n  ILayer,\n  ILayerService,\n  ILngLat,\n  IMapService,\n  IMarker,\n  IMarkerLayer,\n  IMarkerService,\n  IPoint,\n  IPopup,\n  IPopupService,\n  IPostProcessingPass,\n  IRendererService,\n  ISceneConfig,\n  ISceneService,\n  Point,\n  SceneEventList,\n  TYPES,\n} from '@antv/l7-core';\nimport { ReglRendererService } from '@antv/l7-renderer';\nimport { DOM } from '@antv/l7-utils';\nimport { Container } from 'inversify';\nimport ILayerManager from './ILayerManager';\nimport IMapController from './IMapController';\nimport IPostProcessingPassPluggable from './IPostProcessingPassPluggable';\n\n/**\n * 暴露 Scene API\n *\n * @example\n * import { Scene } from 'l7/scene';\n * import { PointLayer } from 'l7/layers';\n *\n * const scene = new Scene();\n * const pointLayer = new PointLayer();\n * scene.addLayer(pointLayer);\n *\n */\nclass Scene\n  implements IPostProcessingPassPluggable, IMapController, ILayerManager {\n  private sceneService: ISceneService;\n  private mapService: IMapService<unknown>;\n  private controlService: IControlService;\n  private layerService: ILayerService;\n  private iconService: IIconService;\n  private markerService: IMarkerService;\n  private popupService: IPopupService;\n\n  private container: Container;\n\n  public constructor(config: ISceneConfig) {\n    const { id, map } = config;\n\n    // 创建场景容器\n    const sceneContainer = createSceneContainer();\n    this.container = sceneContainer;\n    // 绑定地图服务\n    map.setContainer(sceneContainer, id);\n\n    // 绑定渲染引擎服务\n    sceneContainer\n      .bind<IRendererService>(TYPES.IRendererService)\n      .to(ReglRendererService)\n      .inSingletonScope();\n\n    // 依赖注入\n    this.sceneService = sceneContainer.get<ISceneService>(TYPES.ISceneService);\n    this.mapService = sceneContainer.get<IMapService<unknown>>(\n      TYPES.IMapService,\n    );\n    this.iconService = sceneContainer.get<IIconService>(TYPES.IIconService);\n    this.controlService = sceneContainer.get<IControlService>(\n      TYPES.IControlService,\n    );\n    this.layerService = sceneContainer.get<ILayerService>(TYPES.ILayerService);\n\n    this.markerService = sceneContainer.get<IMarkerService>(\n      TYPES.IMarkerService,\n    );\n\n    this.popupService = sceneContainer.get<IPopupService>(TYPES.IPopupService);\n\n    this.initComponent(id);\n\n    // 初始化 scene\n    this.sceneService.init(config);\n    // TODO: 初始化组件\n    this.addControl(new Logo());\n  }\n\n  public getMapService(): IMapService<unknown> {\n    return this.mapService;\n  }\n  public ExportMap2Png(): string {\n    return this.sceneService.ExportMap2Png();\n  }\n\n  public get map() {\n    return this.mapService.map;\n  }\n\n  // layer 管理\n  public addLayer(layer: ILayer): void {\n    // 为当前图层创建一个容器\n    // TODO: 初始化的时候设置 容器\n    const layerContainer = createLayerContainer(this.container);\n    layer.setContainer(layerContainer);\n    this.sceneService.addLayer(layer);\n  }\n\n  public getLayers(): ILayer[] {\n    return this.layerService.getLayers();\n  }\n\n  public getLayer(id: string): ILayer | undefined {\n    return this.layerService.getLayer(id);\n  }\n\n  public removeLayer(layer: ILayer): void {\n    this.layerService.remove(layer);\n  }\n\n  public removeAllLayer(): void {\n    this.layerService.removeAllLayers();\n  }\n\n  public render(): void {\n    this.sceneService.render();\n  }\n\n  // asset method\n  public addImage(id: string, img: IImage) {\n    this.iconService.addImage(id, img);\n  }\n\n  public hasImage(id: string) {\n    this.iconService.hasImage(id);\n  }\n\n  public removeImage(id: string) {\n    this.iconService.removeImage(id);\n  }\n\n  // map control method\n  public addControl(ctr: IControl) {\n    this.controlService.addControl(ctr, this.container);\n  }\n\n  public removeControl(ctr: IControl) {\n    this.controlService.removeControl(ctr);\n  }\n\n  // marker\n  public addMarker(marker: IMarker) {\n    this.markerService.addMarker(marker);\n  }\n\n  public addMarkerLayer(layer: IMarkerLayer) {\n    this.markerService.addMarkerLayer(layer);\n  }\n\n  public removeMarkerLayer(layer: IMarkerLayer) {\n    this.markerService.removeMarkerLayer(layer);\n  }\n\n  public removeAllMakers() {\n    this.markerService.removeAllMarkers();\n  }\n\n  public addPopup(popup: IPopup) {\n    this.popupService.addPopup(popup);\n  }\n\n  public on(type: string, handle: (...args: any[]) => void): void {\n    SceneEventList.indexOf(type) === -1\n      ? this.mapService.on(type, handle)\n      : this.sceneService.on(type, handle);\n  }\n\n  public off(type: string, handle: (...args: any[]) => void): void {\n    SceneEventList.indexOf(type) === -1\n      ? this.mapService.off(type, handle)\n      : this.sceneService.off(type, handle);\n  }\n\n  // implements IMapController\n\n  public getZoom(): number {\n    return this.mapService.getZoom();\n  }\n\n  public getCenter(): ILngLat {\n    return this.mapService.getCenter();\n  }\n\n  public getPitch(): number {\n    return this.mapService.getPitch();\n  }\n\n  public getRotation(): number {\n    return this.mapService.getRotation();\n  }\n\n  public getBounds(): Bounds {\n    return this.mapService.getBounds();\n  }\n\n  public setRotation(rotation: number): void {\n    this.mapService.setRotation(rotation);\n  }\n  public zoomIn(): void {\n    this.mapService.zoomIn();\n  }\n\n  public zoomOut(): void {\n    this.mapService.zoomOut();\n  }\n\n  public panTo(p: Point): void {\n    this.mapService.panTo(p);\n  }\n\n  public panBy(pixel: Point): void {\n    this.mapService.panTo(pixel);\n  }\n\n  public setZoom(zoom: number): void {\n    this.mapService.setZoom(zoom);\n  }\n  public fitBounds(bound: Bounds): void {\n    this.mapService.fitBounds(bound);\n  }\n\n  public setZoomAndCenter(zoom: number, center: Point): void {\n    this.mapService.setZoomAndCenter(zoom, center);\n  }\n\n  public setMapStyle(style: string): void {\n    this.mapService.setMapStyle(style);\n  }\n\n  // conversion Method\n  public pixelToLngLat(pixel: Point): ILngLat {\n    return this.mapService.pixelToLngLat(pixel);\n  }\n\n  public lngLatToPixel(lnglat: Point): IPoint {\n    return this.mapService.lngLatToPixel(lnglat);\n  }\n\n  public containerToLngLat(pixel: Point): ILngLat {\n    return this.mapService.containerToLngLat(pixel);\n  }\n\n  public lngLatToContainer(lnglat: Point): IPoint {\n    return this.mapService.lngLatToContainer(lnglat);\n  }\n\n  public destroy() {\n    this.sceneService.destroy();\n    // TODO: 清理其他 Service 例如 IconService\n  }\n\n  public registerPostProcessingPass(\n    constructor: new (...args: any[]) => IPostProcessingPass<unknown>,\n    name: string,\n  ) {\n    this.container\n      .bind<IPostProcessingPass<unknown>>(TYPES.IPostProcessingPass)\n      .to(constructor)\n      .whenTargetNamed(name);\n  }\n\n  private initComponent(id: string | HTMLDivElement) {\n    this.controlService.init(\n      {\n        container: DOM.getContainer(id),\n      },\n      this.container,\n    );\n    this.markerService.init(this.container);\n    this.popupService.init(this.container);\n  }\n  // 资源管理\n}\n\nexport { Scene };\n"],"file":"index.js"}