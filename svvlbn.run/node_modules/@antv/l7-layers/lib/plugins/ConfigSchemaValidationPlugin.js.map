{"version":3,"sources":["../../src/plugins/ConfigSchemaValidationPlugin.ts"],"names":["ConfigSchemaValidationPlugin","TYPES","IGlobalConfigService","ILogService","layer","hooks","init","tap","configService","registerLayerConfigSchemaValidator","name","getConfigSchemaForValidation","validateLayerConfig","getLayerConfig","valid","errorText","logger","error","beforeRender"],"mappings":";;;;;;;;;;;;;;;;;;;AAAA;;AAOA;;;;IAMqBA,4B,WADpB,4B,UAEE,uBAAOC,cAAMC,oBAAb,C,UAGA,uBAAOD,cAAME,WAAb,C;;;;;;;;;0BAGYC,K,EAAe;AAAA;;AAC1BA,MAAAA,KAAK,CAACC,KAAN,CAAYC,IAAZ,CAAiBC,GAAjB,CAAqB,8BAArB,EAAqD,YAAM;AACzD,QAAA,KAAI,CAACC,aAAL,CAAmBC,kCAAnB,CACEL,KAAK,CAACM,IADR,EAEEN,KAAK,CAACO,4BAAN,EAFF;;AADyD,oCAM5B,KAAI,CAACH,aAAL,CAAmBI,mBAAnB,CAC3BR,KAAK,CAACM,IADqB,EAE3BN,KAAK,CAACS,cAAN,EAF2B,CAN4B;AAAA,YAMjDC,KANiD,yBAMjDA,KANiD;AAAA,YAM1CC,SAN0C,yBAM1CA,SAN0C;;AAWzD,YAAI,CAACD,KAAL,EAAY;AACV,UAAA,KAAI,CAACE,MAAL,CAAYC,KAAZ,CAAkBF,SAAS,IAAI,EAA/B;;AAEA,iBAAO,KAAP;AACD;AACF,OAhBD;AAiBAX,MAAAA,KAAK,CAACC,KAAN,CAAYa,YAAZ,CAAyBX,GAAzB,CAA6B,8BAA7B,EAA6D,YAAM,CAElE,CAFD;AAGD","sourcesContent":["import {\n  IGlobalConfigService,\n  ILayer,\n  ILayerPlugin,\n  ILogService,\n  TYPES,\n} from '@antv/l7-core';\nimport { inject, injectable } from 'inversify';\n\n/**\n * Layer 初始化阶段以及重绘阶段首先校验传入参数，如果校验失败则中断后续插件处理。\n */\n@injectable()\nexport default class ConfigSchemaValidationPlugin implements ILayerPlugin {\n  @inject(TYPES.IGlobalConfigService)\n  private readonly configService: IGlobalConfigService;\n\n  @inject(TYPES.ILogService)\n  private readonly logger: ILogService;\n\n  public apply(layer: ILayer) {\n    layer.hooks.init.tap('ConfigSchemaValidationPlugin', () => {\n      this.configService.registerLayerConfigSchemaValidator(\n        layer.name as string,\n        layer.getConfigSchemaForValidation(),\n      );\n\n      const { valid, errorText } = this.configService.validateLayerConfig(\n        layer.name as string,\n        layer.getLayerConfig(),\n      );\n\n      if (!valid) {\n        this.logger.error(errorText || '');\n        // 中断 init 过程\n        return false;\n      }\n    });\n    layer.hooks.beforeRender.tap('ConfigSchemaValidationPlugin', () => {\n      // TODO: 配置项发生变化，需要重新校验\n    });\n  }\n}\n"],"file":"ConfigSchemaValidationPlugin.js"}